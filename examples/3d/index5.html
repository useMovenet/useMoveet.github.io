<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoveNet Bone Logger</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000;
        }
    </style>
</head>
<body>
    <video id="video" playsinline style="display:none;"></video>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>
    <script>
        async function setupMoveNet() {
            const video = document.getElementById('video');

            const detector = await poseDetection.createDetector(
                poseDetection.SupportedModels.MoveNet, 
                { modelType: poseDetection.movenet.modelType.SINGLEPOSE_LIGHTNING }
            );
            console.log("MoveNet model loaded.");

            const stream = await navigator.mediaDevices.getUserMedia({
                video: true
            });
            video.srcObject = stream;

            return new Promise((resolve) => {
                video.onloadedmetadata = () => {
                    video.play();
                    resolve({ detector, video });
                };
            });
        }

        async function logBones(detector, video) {
            const poses = await detector.estimatePoses(video);
            
            if (poses.length > 0) {
                const keypoints = poses[0].keypoints;

                const bones = [
                    ['leftShoulder', 'leftElbow'],
                    ['leftElbow', 'leftWrist'],
                    ['rightShoulder', 'rightElbow'],
                    ['rightElbow', 'rightWrist'],
                    ['leftShoulder', 'leftHip'],
                    ['rightShoulder', 'rightHip'],
                    ['leftHip', 'leftKnee'],
                    ['leftKnee', 'leftAnkle'],
                    ['rightHip', 'rightKnee'],
                    ['rightKnee', 'rightAnkle'],
                    ['leftHip', 'rightHip'],
                    ['leftShoulder', 'rightShoulder']
                ];

                const bonePositions = bones.map(([partA, partB]) => {
                    const pointA = keypoints.find(k => k.name === partA);
                    const pointB = keypoints.find(k => k.name === partB);
                    
                    if (pointA && pointB && pointA.score > 0.5 && pointB.score > 0.5) {
                        return {
                            bone: `${partA} -> ${partB}`,
                            positionA: { x: pointA.x, y: pointA.y },
                            positionB: { x: pointB.x, y: pointB.y }
                        };
                    } else {
                        return null;
                    }
                }).filter(b => b !== null);

                console.log('Bone Positions:', bonePositions);
            } else {
                console.log('No pose detected.');
            }
        }

        async function main() {
            const { detector, video } = await setupMoveNet();

            // Log bones every 2 seconds
            setInterval(() => {
                logBones(detector, video);
            }, 2000);
        }

        main();
    </script>
</body>
</html>